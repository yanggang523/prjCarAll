/*******************************************************
This program was created by the CodeWizardAVR V3.49a 
Automatic Program Generator
© Copyright 1998-2022 Pavel Haiduc, HP InfoTech S.R.L.
http://www.hpinfotech.ro

Project : RCCAR
Version : 1.1.0
Date    : 2024-12-12
Author  : ê°•ê²½ì•„, ì„±í˜¸ì¬
Company : ê²½ìƒêµ­ë¦½ëŒ€í•™êµ ì†Œì† í•™ìƒ
Comments: I want ì¢…ê°• 


Chip type               : ATmega128
Program type            : Application
AVR Core Clock frequency: 16.000000 MHz
Memory model            : Small
External RAM size       : 0
Data Stack size         : 1024
*******************************************************/

// I/O Registers definitions
#define F_CPU 8000000UL
#define BAUD 9600
#define U2X_S 2
#define MYUBRR ((F_CPU * U2X_S) / (16L * BAUD) - 1)

#include <mega128.h>
#include <delay.h>
#include <stdio.h>
#include <stdint.h>

// í•¨ìˆ˜ ì„ ì–¸
void timer0_init(void);
void timer2_init(void);
void USART0_Init(unsigned int ubrr);
void Go_Straight(void);
void Turn_Left(void);
void Turn_Right(void);
void Back(void);
void Stop(void);

// ì „ì—­ ë³€ìˆ˜
volatile uint16_t total_count = 0;
char ch;

interrupt [TIM1_COMPA] void timer1_compa_isr(void) {
    total_count++;
}

// USART0 ì´ˆê¸°í™” í•¨ìˆ˜
void USART0_Init(unsigned int ubrr) {
    UBRR0H = (unsigned char)(ubrr >> 8);
    UBRR0L = (unsigned char)ubrr;
    UCSR0B = (1 << RXEN0) | (1 << TXEN0);
    UCSR0C = (1 << UCSZ01) | (1 << UCSZ00);
}

// íƒ€ì´ë¨¸0 ì´ˆê¸°í™” í•¨ìˆ˜
void timer0_init(void) {
    TCCR0 = 0b01101100;  // Fast PWM ëª¨ë“œ ì„¤ì •
}

// íƒ€ì´ë¨¸2 ì´ˆê¸°í™” í•¨ìˆ˜
void timer2_init(void) {
    TCCR2 = 0b01101011;  // Fast PWM ëª¨ë“œ ì„¤ì •
}

// ì´ë™ í•¨ìˆ˜ë“¤
void Go_Straight(void) {
    OCR0 = 90;
    PORTB.2 = 0;
    PORTB.3 = 1;

    OCR2 = 90;
    PORTB.0 = 0;
    PORTB.1 = 1;
}

void Back(void) {
    OCR0 = 90;
    PORTB.2 = 1;
    PORTB.3 = 0;

    OCR2 = 90;
    PORTB.0 = 1;
    PORTB.1 = 0;
}

void Turn_Right(void) {
    OCR0 = 90;
    PORTB.2 = 1;
    PORTB.3 = 0;

    OCR2 = 90;
    PORTB.0 = 0;
    PORTB.1 = 1;
}

void Turn_Left(void) {
    OCR0 = 90;
    PORTB.2 = 0;
    PORTB.3 = 1;

    OCR2 = 90;
    PORTB.0 = 1;
    PORTB.1 = 0;
}

void Stop(void) {
    OCR0 = 0;
    PORTB.2 = 0;
    PORTB.3 = 0;

    OCR2 = 0;
    PORTB.0 = 0;
    PORTB.1 = 0;
}

void main(void) {
    DDRB = 0xFF;      // PORTBë¥¼ ì¶œë ¥ìœ¼ë¡œ ì„¤ì •
    timer0_init();    // íƒ€ì´ë¨¸0 ì´ˆê¸°í™”
    timer2_init();    // íƒ€ì´ë¨¸2 ì´ˆê¸°í™”
    USART0_Init(MYUBRR);  // USART0 ì´ˆê¸°í™”

    #asm("sei")  // ì „ì—­ ì¸í„°ëŸ½íŠ¸ í™œì„±í™”

//main


while (1)
      {    
                     //í…ŒìŠ¤íŠ¸ ëª©
          delay_ms(5000);       // 5ì´ˆ ë™ì•ˆ ëŒ€ê¸°   
           Go_Straight();  // ì§ì§„
        delay_ms(2000); // 2ì´ˆ ë™ì•ˆ ì§ì§„
        Stop();
        delay_ms(500);  // 0.5ì´ˆ ë™ì•ˆ ì •ì§€

        Turn_Right();   // ìš°íšŒì „
        delay_ms(2000); // 2ì´ˆ ë™ì•ˆ ìš°íšŒì „
        Stop();
        delay_ms(500);

        Turn_Left();    // ì¢ŒíšŒì „
        delay_ms(2000); // 2ì´ˆ ë™ì•ˆ ì¢ŒíšŒì „
        Stop();
        delay_ms(500);

        Back();         // í›„ì§„
        delay_ms(2000); // 2ì´ˆ ë™ì•ˆ í›„ì§„
        Stop();
        delay_ms(500);

      
           if (UCSR0A & (1 << RXC0)) {
                ch = UDR0;

                if (ch == '8') {
                    Go_Straight(); 
                } else if (ch == '2') {
                    Back();
                } else if (ch == '4') {
                    Turn_Left();
                } else if (ch == '6') {
                    Turn_Right();
                } else if (ch == '5') {
                    Stop();
                }
            }       
        }
        
      // Place your code here

      
}
